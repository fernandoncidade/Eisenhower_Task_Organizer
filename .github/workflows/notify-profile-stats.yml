name: Notify profile stats updater

on:
  push:
    branches:
      - "**"   # ou restrinja para main/master se quiser
  workflow_dispatch:

permissions:
  contents: read

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch update to profile repo
        env:
          PROFILE_REPO: fernandoncidade/fernandoncidade
          EVENT_TYPE: repo-push
          GH_TOKEN: ${{ secrets.PROFILE_DISPATCH_TOKEN }}
        run: |
          set -euo pipefail

          # Dispara repository_dispatch no repo do perfil
          curl -sS -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${GH_TOKEN}" \
            "https://api.github.com/repos/${PROFILE_REPO}/dispatches" \
            -d "$(jq -nc \
              --arg event_type "${EVENT_TYPE}" \
              --arg repo "${GITHUB_REPOSITORY}" \
              --arg ref "${GITHUB_REF}" \
              --arg sha "${GITHUB_SHA}" \
              '{event_type:$event_type, client_payload:{repo:$repo, ref:$ref, sha:$sha}}' \
            )"
